app-id: io.github.divverent.aaaaxy
runtime: org.freedesktop.Platform
runtime-version: '21.08'
# Do we need to provide a GL extension somehow?
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang
command: aaaaxy
cleanup:
  - /builddeps
finish-args:
  # Needed to access gamepads and for 3D graphics.
  # If we ever get a gamepad-specific permission, switch to that + dri instead.
  - --device=all
  # Needed for XShm.
  - --share=ipc
  # Needed for X11.
  - --socket=x11
  # Needed for audio playback.
  - --socket=pulseaudio
modules:
  - name: graphviz
    sources:
      - type: archive
        url: https://gitlab.com/api/v4/projects/4207231/packages/generic/graphviz-releases/2.50.0/graphviz-2.50.0.tar.gz
        sha256: e17021a510bbd2770d4ca4b4eb841138122aaa5948f9e617e6bc12b4bac62e8d
    config-opts:
      # Graphviz is only used during the build process, so install it to a
      # separate place we can keep out of the flatpak.
      - --prefix=/app/builddeps
  - name: imagemagick
    sources:
      - type: archive
        url: https://github.com/ImageMagick/ImageMagick6/archive/6.9.12-32.tar.gz
        sha256: 61943b71ae01bdace5a8d15bee4c3ee607001d026e94c0bfe2a4c3b2a312c91a
    config-opts:
      # ImageMagick is only used during the build process, so install it to a
      # separate place we can keep out of the flatpak.
      - --prefix=/app/builddeps
  - name: aaaaxy
    buildsystem: simple
    build-commands:
      - |
        . /usr/lib/sdk/golang/enable.sh
        export PATH=/app/builddeps/bin:$PATH
        make BUILDTYPE=release BINARY=/app/bin/aaaaxy
        mkdir -p /app/share/icons/hicolor/128x128/apps
        cp aaaaxy.png /app/share/icons/hicolor/128x128/apps/io.github.divverent.aaaaxy.png
        mkdir -p /app/share/applications
        sed -e 's,Icon=aaaaxy,Icon=io.github.divverent.aaaaxy,' < aaaaxy.desktop > /app/share/applications/io.github.divverent.aaaaxy.desktop
        mkdir -p /app/share/metainfo
        sed -e 's,aaaaxy\.png,io.github.divverent.aaaaxy.png,; s,aaaaxy\.desktop,io.github.divverent.aaaaxy.desktop,g' < io.github.divverent.aaaaxy.metainfo.xml > /app/share/metainfo/io.github.divverent.aaaaxy.appdata.xml
    sources:
      - type: git
        url: https://github.com/divVerent/aaaaxy
        tag: v1.0.89
        commit: febd2223d1d3bcb8eea306e48917301982749cec
        # Needed to allow querying the version during build.
        disable-shallow-clone: true
      - type: file
        path: modules.txt
        dest: vendor
      # --- GO MODULES START HERE, USE go-vendor-to-flatpak-yml.sh TO UPDATE ---
      - type: git
        url: https://github.com/adrg/xdg
        tag: v0.4.0
        commit: 4ec40e24f0cf1039f93c773f2984decdea9719b5
        dest: vendor/github.com/adrg/xdg
      - type: git
        url: https://github.com/akavel/rsrc
        tag: v0.10.2
        commit: 936343600d578fb5da472acf6987ed76935a389b
        dest: vendor/github.com/akavel/rsrc
      - type: git
        url: https://github.com/dchest/jsmin
        commit: faeced8839472f349011f4c4c5441bbc28d02191
        dest: vendor/github.com/dchest/jsmin
      - type: git
        url: https://github.com/emirpasic/gods
        tag: v1.12.0
        commit: 1615341f118ae12f353cc8a983f35b584342c9b3
        dest: vendor/github.com/emirpasic/gods
      - type: git
        url: https://github.com/fardog/tmx
        commit: 02c45f26167251c118de4f2b10f42fe43f1ad413
        dest: vendor/github.com/fardog/tmx
      - type: git
        url: https://github.com/go-gl/glfw
        commit: 40e447a793be3543d926449946f77f85505dbeed
        dest: vendor/github.com/go-gl/glfw
      - type: git
        url: https://github.com/golang/freetype
        commit: e2365dfdc4a05e4b8299a783240d4a7d5a65d4e4
        dest: vendor/github.com/golang/freetype
      - type: git
        url: https://github.com/golang/glog
        commit: 23def4e6c14b4da8ac2ed8007337bc5eb5007998
        dest: vendor/github.com/golang/glog
      - type: git
        url: https://github.com/google/go-cmp
        tag: v0.5.6
        commit: d103655696d8ae43c4125ee61454dbf03d8e8324
        dest: vendor/github.com/google/go-cmp
      - type: git
        url: https://github.com/google/go-licenses
        commit: ceb292363ec84358c9a276ef23aa0de893e59b84
        dest: vendor/github.com/google/go-licenses
